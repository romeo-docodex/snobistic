{% extends "base.html" %}
{% block title %}Istoric autentificări{% endblock %}
{% block content %}
<h1>Istoricul cererilor mele de autentificare</h1>

<table class="table align-middle">
  <thead>
    <tr>
      <th>Data</th>
      <th>Produs</th>
      <th>Status</th>
      <th>Verdict</th>
      <th>Certificat</th>
    </tr>
  </thead>
  <tbody>
    {% for req in history %}
    <tr>
      <td>{{ req.submitted_at|date:"Y-m-d H:i" }}</td>
      <td>
        {% if req.product %}
          <a href="{{ req.product.get_absolute_url }}">{{ req.product.title }}</a>
        {% else %}
          {{ req.brand_text }} / {{ req.model_text }}
        {% endif %}
      </td>
      <td>{{ req.get_status_display }}</td>
      <td>{{ req.get_verdict_display }}</td>
      <td>
        {% if req.status == req.Status.SUCCESS %}
          {% if req.certificate_file or req.certificate_url %}
            <a href="{% url 'authenticator:download_certificate' req.pk %}" class="btn btn-sm btn-outline-secondary">
              Descarcă / Vezi
            </a>
          {% else %}
            —
          {% endif %}
        {% else %}
          —
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="5">Nu ai nici o cerere înregistrată.</td></tr>
    {% endfor %}
  </tbody>
</table>

<a href="{% url 'authenticator:authenticate_product' %}" class="btn btn-link">Autentifică un alt produs</a>
{% endblock %}
