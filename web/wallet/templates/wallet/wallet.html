{# templates/wallet/wallet.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Portofel – Snobistic{% endblock %}

{% block content %}

<style>
  /* Wallet page – look & feel similar cu dashboard/account pages */

  .wallet-card.dashboard-card,
  .wallet-card.dashboard-card .account-address-item {
    border-radius: 16px;
  }

  /* Card styling compatibil cu seller dashboard cards */
  .account-address-item.dashboard-card {
    padding: 1.5rem 1.75rem;
    border-radius: 16px;
    border: 1px solid rgba(15, 23, 42, 0.04);
    background-color: #ffffff;
    box-shadow: 0 12px 30px rgba(15, 23, 42, 0.04);
  }

  .account-address-item.dashboard-card .title {
    margin-bottom: 0.9rem;
    font-size: 0.98rem;
  }

  .account-address-item.dashboard-card p,
  .account-address-item.dashboard-card li,
  .account-address-item.dashboard-card td,
  .account-address-item.dashboard-card th {
    font-size: 0.85rem;
  }

  .account-address-item.dashboard-card .text-xxs {
    font-size: 0.8rem;
  }

  .wallet-section-title {
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #9ca3af;
    margin-bottom: 0.75rem;
  }

  .wallet-balance-amount {
    font-size: 1.75rem;
    font-weight: 600;
    line-height: 1.1;
  }

  .wallet-actions .tf-btn {
    min-width: 160px;
  }

  .wallet-table thead th {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: #6b7280;
  }

  @media (min-width: 992px) {
    .account-address-item.dashboard-card {
      padding: 1.75rem 2rem;
    }
  }
</style>

{# ==== Titlu pagină + breadcrumb ==== #}
<section class="tf-page-title">
  <div class="container">
    <div class="box-title text-center">
      <h4 class="title">Portofel</h4>
      <div class="breadcrumb-list">
        <a class="breadcrumb-item" href="{% url 'core:home' %}">Acasă</a>
        <div class="breadcrumb-item dot"><span></span></div>
        <a class="breadcrumb-item" href="{% url 'accounts:profile' %}">Cont</a>
        <div class="breadcrumb-item dot"><span></span></div>
        <div class="breadcrumb-item current">Portofel</div>
      </div>
    </div>
  </div>
</section>

<div class="flat-spacing-13">
  <div class="container-7">

    {# Sidebar button (mobil) #}
    <div class="btn-sidebar-mb d-lg-none mb-3">
      <button data-bs-toggle="offcanvas" data-bs-target="#mbAccount">
        <i class="icon icon-sidebar"></i>
      </button>
    </div>

    <div class="main-content-account">

      {# Sidebar cont (desktop) #}
      {% include "accounts/profile/_account_sidebar.html" with account_section="wallet" %}

      {# ==== Conținut principal – Wallet ==== #}
      <div class="my-acount-content account-address">
        <h6 class="title-account mb-2">
          Portofel Snobistic
        </h6>
        <p class="text-sm text-grey mb-4">
          Aici îți gestionezi soldul și vezi rapid ultimele tranzacții (încărcări, plăți, retrageri).
        </p>

        <div class="widget-inner-address">

          {# ==== Card: Sold + acțiuni ==== #}
          <div class="account-address-item dashboard-card mb-4">
            <div class="wallet-section-title">
              Sold curent
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
              <div>
                <div class="wallet-balance-amount">
                  {{ wallet.balance }} {{ wallet.currency }}
                </div>
                <p class="text-xxs text-grey mb-0 mt-2">
                  Soldul disponibil pentru cumpărături sau retragere.
                </p>
              </div>

              <div class="wallet-actions d-flex flex-column flex-sm-row gap-2">
                <a href="{% url 'wallet:topup' %}"
                   class="tf-btn btn-dark">
                  Alimentează
                </a>
                <a href="{% url 'wallet:withdraw' %}"
                   class="tf-btn btn-out-line-dark">
                  Retrage
                </a>
                <a href="{% url 'wallet:transactions' %}"
                   class="tf-btn btn-out-line-dark">
                  Tranzacții
                </a>
              </div>
            </div>
          </div>

          {# ==== Card: Ultimele tranzacții ==== #}
          <div class="account-address-item dashboard-card">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-3">
              <div>
                <div class="wallet-section-title mb-1">Ultimele tranzacții</div>
                <p class="text-xxs text-grey mb-0">
                  Lista de mai jos arată cele mai recente operațiuni din portofel.
                </p>
              </div>

              <div class="text-md-end">
                <a href="{% url 'wallet:transactions' %}"
                   class="text-xxs text-grey text-decoration-underline">
                  Vezi toate tranzacțiile
                </a>
              </div>
            </div>

            {% if txs %}
              <div class="table-responsive">
                <table class="table mb-0 align-middle wallet-table">
                  <thead class="table-light">
                    <tr>
                      <th>Data</th>
                      <th>Tip</th>
                      <th>Direcție</th>
                      <th class="text-end">Sumă</th>
                      <th class="text-end">Sold după</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for tx in txs %}
                      <tr>
                        <td class="small text-muted">
                          {{ tx.created_at|date:"Y-m-d H:i" }}
                        </td>
                        <td class="small">
                          <strong>{{ tx.get_tx_type_display }}</strong>
                        </td>
                        <td class="small text-muted">
                          {{ tx.get_direction_display }}
                        </td>

                        <td class="text-end">
                          {% if tx.direction == "DEBIT" %}
                            <span class="text-danger">-{{ tx.amount }} {{ wallet.currency }}</span>
                          {% else %}
                            <span class="text-success">+{{ tx.amount }} {{ wallet.currency }}</span>
                          {% endif %}
                        </td>

                        <td class="text-end small text-muted">
                          {{ tx.balance_after }} {{ wallet.currency }}
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="py-4 text-center text-muted">
                Nu ai tranzacții încă.
              </div>
            {% endif %}
          </div>

        </div> {# /widget-inner-address #}
      </div> {# /my-acount-content #}

    </div> {# /main-content-account #}
  </div>
</div>

{% endblock %}
