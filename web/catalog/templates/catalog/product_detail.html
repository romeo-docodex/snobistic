{% extends "base.html" %}
{% load static %}
{% block title %}{{ product.title }} – Snobistic{% endblock %}

{% block content %}

{# ---------- helpers for display size ---------- #}
{% with display_size=product.display_size %}
  {% if product.shoe_size_eu %}
    {% with display_size="EU "|add:product.shoe_size_eu %}
    {% endwith %}
  {% endif %}
{% endwith %}

<!-- Breadcrumb -->
<div class="breadcrumb-sec">
  <div class="container">
    <div class="breadcrumb-wrap">
      <div class="breadcrumb-list">
        <a class="breadcrumb-item" href="{% url 'catalog:product_list' %}">Home</a>
        <div class="breadcrumb-item dot"><span></span></div>

        <a class="breadcrumb-item" href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>

        {% if product.subcategory %}
          <div class="breadcrumb-item dot"><span></span></div>
          <span class="breadcrumb-item">{{ product.subcategory.get_breadcrumb }}</span>
        {% endif %}

        <div class="breadcrumb-item dot"><span></span></div>
        <div class="breadcrumb-item current">{{ product.title }}</div>
      </div>
    </div>
  </div>
</div>
<!-- /Breadcrumb -->

<!-- Product Main -->
<section class="flat-single-product">
  <div class="tf-main-product section-image-zoom">
    <div class="container">
      <div class="row">

        <!-- Product Images -->
        <div class="col-md-6">
          <div class="tf-product-media-wrap sticky-top">
            <div class="product-thumbs-slider">
              <div class="flat-wrap-media-product">
                <div dir="ltr" class="swiper tf-product-media-main" id="gallery-swiper-started">
                  <div class="swiper-wrapper">

                    <!-- main image -->
                    <div class="swiper-slide">
                      <a href="{{ product.main_image.url }}" target="_blank" class="item" data-pswp-width="1200" data-pswp-height="1200">
                        <img class="tf-image-zoom lazyload"
                             data-zoom="{{ product.main_image.url }}"
                             data-src="{{ product.main_image.url }}"
                             src="{{ product.main_image.url }}"
                             alt="{{ product.title }}">
                      </a>
                    </div>

                    <!-- extra images -->
                    {% for img in product.images.all %}
                    <div class="swiper-slide">
                      <a href="{{ img.image.url }}" target="_blank" class="item" data-pswp-width="1200" data-pswp-height="1200">
                        <img class="tf-image-zoom lazyload"
                             data-zoom="{{ img.image.url }}"
                             data-src="{{ img.image.url }}"
                             src="{{ img.image.url }}"
                             alt="{{ img.alt_text|default:product.title }}">
                      </a>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                <div class="swiper-button-next nav-swiper thumbs-next"></div>
                <div class="swiper-button-prev nav-swiper thumbs-prev"></div>
              </div>

              <div dir="ltr" class="swiper tf-product-media-thumbs other-image-zoom" data-preview="4" data-direction="vertical">
                <div class="swiper-wrapper stagger-wrap">
                  <!-- thumbs main -->
                  <div class="swiper-slide stagger-item">
                    <div class="item">
                      <img class="lazyload" data-src="{{ product.main_image.url }}" src="{{ product.main_image.url }}" alt="{{ product.title }}">
                    </div>
                  </div>
                  <!-- thumbs extras -->
                  {% for img in product.images.all %}
                  <div class="swiper-slide stagger-item">
                    <div class="item">
                      <img class="lazyload" data-src="{{ img.image.url }}" src="{{ img.image.url }}" alt="{{ img.alt_text|default:product.title }}">
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>

            </div>
          </div>
        </div>
        <!-- /Product Images -->

        <!-- Product Info -->
        <div class="col-md-6">
          <div class="tf-zoom-main"></div>
          <div class="tf-product-info-wrap other-image-zoom">
            <div class="tf-product-info-list">

              <!-- Heading -->
              <div class="tf-product-heading">
                <div class="row align-items-start">
                  <div class="col-12">
                    {% if product.display_brand %}
                      <span class="brand-product">{{ product.display_brand }}</span>
                    {% endif %}

                    <h5 class="product-name fw-medium">{{ product.title }}</h5>

                    <div class="product-price mt-3">
                      <div class="display-sm price-new price-on-sale">
                        {{ product.price }} RON
                      </div>
                    </div>

                    <div class="product-stock mt-1">
                      {% if product.is_active and not product.is_archived %}
                        <span class="stock in-stock">În stoc</span>
                      {% else %}
                        <span class="stock out-stock">Stoc epuizat</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>

              <!-- Variants -->
              <div class="tf-product-variant">

                {% if product.base_color or product.colors.all %}
                <div class="variant-picker-item variant-color">
                  <div class="variant-picker-label">
                    Culoare:
                    <span class="variant-picker-label-value value-currentColor">
                      {% firstof product.real_color_name product.base_color.name product.colors.first.name "—" %}
                    </span>
                  </div>

                  <div class="variant-picker-values">
                    {# SINGLE color UI: prefer base_color; fallback first from colors #}
                    {% if product.base_color %}
                      <div class="hover-tooltip tooltip-bot color-btn active">
                        <span class="check-color" style="background: {{ product.base_color.hex_code|default:'#eee' }};"></span>
                        <span class="tooltip">{% firstof product.real_color_name product.base_color.name %}</span>
                      </div>
                    {% else %}
                      {% for c in product.colors.all|slice:":1" %}
                        <div class="hover-tooltip tooltip-bot color-btn active">
                          <span class="check-color" style="background: {{ c.hex_code|default:'#eee' }};"></span>
                          <span class="tooltip">{% firstof product.real_color_name c.name %}</span>
                        </div>
                      {% endfor %}
                    {% endif %}
                  </div>
                </div>
                {% endif %}

                <div class="variant-picker-item variant-size">
                  <div class="variant-picker-label">
                    <div>Mărime:
                      <span class="variant-picker-label-value value-currentSize">
                        {% if product.shoe_size_eu %}EU {{ product.shoe_size_eu }}
                        {% elif product.size_fr %}FR {{ product.size_fr }}
                        {% elif product.size_it %}IT {{ product.size_it }}
                        {% elif product.size_gb %}GB {{ product.size_gb }}
                        {% else %}{{ product.display_size }}{% endif %}
                      </span>
                    </div>
                    <a href="#sizeGuide" data-bs-toggle="modal" class="size-guide link">Ghid mărimi</a>
                  </div>
                </div>
              </div>

              <!-- SKU & Categories -->
              <ul class="tf-product-cate-sku text-md tf-product-heading">
                <li class="item-cate-sku">
                  <span class="label">SKU:</span>
                  <span class="value">{{ product.sku }}</span>
                </li>

                <li class="item-cate-sku">
                  <span class="label">Categorie:</span>
                  <span class="value">{{ product.category.name }}</span>
                </li>

                {% if product.subcategory %}
                  <li class="item-cate-sku">
                    <span class="label">Subcategorie:</span>
                    <span class="value">{{ product.subcategory.get_breadcrumb }}</span>
                  </li>
                {% endif %}

                {% if product.display_brand %}
                  <li class="item-cate-sku">
                    <span class="label">Brand:</span>
                    <span class="value">{{ product.display_brand }}</span>
                  </li>
                {% endif %}

                <li class="item-cate-sku">
                  <span class="label">Condiție:</span>
                  <span class="value">{{ product.get_condition_display }}</span>
                </li>
              </ul>

              <!-- Vândut de -->
              <div class="product-seller d-flex flex-column gap-1 tf-product-heading">
                <span class="text-sm text-main-4 py-3">Vândut de:</span>

                <div class="d-flex align-items-center gap-2">
                  <div class="avatar-seller rounded-circle overflow-hidden">
                    {% if product.owner.profile and product.owner.profile.avatar %}
                      <img src="{{ product.owner.profile.avatar.url }}"
                          alt="{{ product.owner.full_name }}"
                          width="30" height="30" class="img-fluid">
                    {% else %}
                      <img src="{% static 'images/placeholders/avatar-default.png' %}"
                          alt="{{ product.owner.full_name|default:product.owner.email }}"
                          width="30" height="30"
                          class="img-fluid">
                    {% endif %}
                  </div>

                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <span class="fw-medium text-md">
                      {{ product.owner.full_name|default:product.owner.email }}
                    </span>

                    {% with sp=product.owner.sellerprofile %}
                      {% if sp %}
                        <span
                          class="ms-1 has-tip"
                          data-bs-toggle="tooltip"
                          data-bs-placement="bottom"
                          data-bs-title="Trust Seller {{ sp.seller_trust_score }}/100 ({{ sp.seller_trust_class }})"
                          aria-label="Trust Seller {{ sp.seller_trust_score }}/100 ({{ sp.seller_trust_class }})"
                          tabindex="0">

                          {% if sp.seller_trust_class == 'A' %}
                            <img src="{% static 'images/badge/trust_seller_a.png' %}"
                                alt="Trust Seller A"
                                class="badge-icon">
                          {% elif sp.seller_trust_class == 'B' %}
                            <img src="{% static 'images/badge/trust_seller_b.png' %}"
                                alt="Trust Seller B"
                                class="badge-icon">
                          {% elif sp.seller_trust_class == 'C' %}
                            <img src="{% static 'images/badge/trust_seller_c.png' %}"
                                alt="Trust Seller C"
                                class="badge-icon">
                          {% else %}
                            <img src="{% static 'images/badge/trust_seller_d.png' %}"
                                alt="Trust Seller D"
                                class="badge-icon">
                          {% endif %}
                        </span>
                      {% endif %}
                    {% endwith %}

                    {% with prof=product.owner.profile %}
                      {% if prof.has_kyc_badge %}
                        <span
                          class="badge-icon badge-icon--kyc ms-1 has-tip"
                          data-bs-toggle="tooltip"
                          data-bs-placement="bottom"
                          data-bs-title="KYC verificat"
                          aria-label="KYC verificat"
                          tabindex="0">
                          <img src="{% static 'images/badge/kyc_verified.png' %}"
                              alt="KYC Verified badge"
                              loading="lazy">
                        </span>
                      {% endif %}
                    {% endwith %}
                  </div>
                </div>
              </div>

              <!-- ATC -->
              <div class="tf-product-total-quantity">
                <form class="w-100" method="post" action="{% url 'cart:add' product.pk %}">
                  {% csrf_token %}
                  <div class="group-btn">
                    <button class="tf-btn btn-primary w-100 animate-btn btn-add-to-cart"
                            type="submit"
                            {% if not product.is_active or product.is_archived %}disabled{% endif %}>
                      Adaugă în coș
                    </button>
                  </div>
                </form>

                {% if is_owner and can_start_auction %}
                  <a href="{% url 'auctions:create_auction' product_slug=product.slug %}"
                     class="tf-btn btn-outline-primary w-100 mt-3">
                    Pornește licitație pentru acest produs
                  </a>
                {% endif %}

                {% if has_auction and auction %}
                  <a href="{% url 'auctions:auction_detail' auction.pk %}"
                     class="tf-btn btn-outline-secondary w-100 mt-2">
                    Vezi licitația activă
                  </a>
                {% endif %}
              </div>

              <!-- Extras -->
              <div class="tf-product-extra-link m-auto">
                <form method="post"
                      action="{% url 'catalog:toggle_favorite' product.pk %}"
                      class="js-fav-form d-inline"
                      data-product-id="{{ product.pk }}">
                  {% csrf_token %}
                  <button type="submit"
                          class="product-extra-icon link btn-add-wishlist {% if product.pk in favorite_ids %}active{% endif %}"
                          data-toggle-fav
                          aria-pressed="{% if product.pk in favorite_ids %}true{% else %}false{% endif %}">
                    <i class="icon add icon-heart"></i><span class="add">Adaugă la favorite</span>
                    <i class="icon added icon-trash"></i><span class="added">Șterge de la favorite</span>
                  </button>
                </form>
                <a href="#compare" data-bs-toggle="modal" class="product-extra-icon link"><i class="icon icon-compare2"></i>Compară</a>
                <a href="#askQuestion" data-bs-toggle="modal" class="product-extra-icon link"><i class="icon icon-ask"></i>Întreabă</a>
                <a href="#shareSocial" data-bs-toggle="modal" class="product-extra-icon link"><i class="icon icon-share"></i>Share</a>
              </div>

              <!-- Trust badges -->
              <div class="tf-product-trust-seal text-center">
                <ul class="list-card">
                  <li class="card-item"><img src="https://themesflat.co/html/vineta/images/payment/Visa.png" alt="Visa"></li>
                  <li class="card-item"><img src="https://themesflat.co/html/vineta/images/payment/Mastercard.png" alt="Mastercard"></li>
                  <li class="card-item"><img src="https://themesflat.co/html/vineta/images/payment/Stripe.png" alt="Stripe"></li>
                  <li class="card-item"><img src="https://themesflat.co/html/vineta/images/payment/PayPal.png" alt="PayPal"></li>
                  <li class="card-item"><img src="https://themesflat.co/html/vineta/images/payment/ApplePay.png" alt="Apple Pay"></li>
                  <li class="card-item"><img src="https://themesflat.co/html/vineta/images/payment/GooglePay.png" alt="Google Pay"></li>
                </ul>
              </div>

              <!-- Livrare & transport (dinamic) -->
              <div class="tf-product-delivery-return">
                <div class="product-delivery">
                  <div class="icon icon-car2"></div>
                  {% with days=product.get_shipping_days_estimate %}
                    {% if days.0 %}
                      <p class="text-md">
                        Livrare estimată:
                        <span class="fw-medium">{{ days.0 }}–{{ days.1 }} zile</span>
                      </p>
                    {% else %}
                      <p class="text-md">
                        Livrare estimată:
                        <span class="fw-medium">1–3 zile</span>
                      </p>
                    {% endif %}
                  {% endwith %}
                </div>
                <div class="product-delivery">
                  <div class="icon icon-shipping3"></div>
                  {% with price=product.get_shipping_price_estimate %}
                    {% if price %}
                      <p class="text-md">
                        Transport de la <span class="fw-medium">{{ price }} RON</span>
                      </p>
                    {% else %}
                      <p class="text-md">
                        Transportul se calculează în pagina de checkout.
                      </p>
                    {% endif %}
                  {% endwith %}
                </div>
              </div>
            </div>

          </div>
        </div>
        <!-- /Product Info -->

      </div>
    </div>
  </div>

  <!-- Sticky ATC -->
  <div class="tf-sticky-btn-atc">
    <div class="container">
      <div class="tf-height-observer w-100 d-flex align-items-center">
        <div class="tf-sticky-atc-product d-flex align-items-center">
          <div class="tf-sticky-atc-img">
            <img class="lazyload"
                 data-src="{{ product.main_image.url }}"
                 src="{{ product.main_image.url }}"
                 alt="{{ product.title }}">
          </div>
          <div class="tf-sticky-atc-title fw-5 d-xl-block d-none">
            {{ product.title }}
          </div>
        </div>

        <div class="tf-sticky-atc-infos">
          <form method="post"
                action="{% url 'cart:add' product.pk %}"
                class="d-flex align-items-center justify-content-end gap-3">
            {% csrf_token %}
            <input type="hidden" name="quantity" value="1">

            <div class="tf-sticky-atc-variant-price text-center">
              <p>
                {% if product.display_brand %}{{ product.display_brand }} – {% endif %}
                {% if product.shoe_size_eu %}EU {{ product.shoe_size_eu }}
                {% elif product.size_fr %}FR {{ product.size_fr }}
                {% elif product.size_it %}IT {{ product.size_it }}
                {% elif product.size_gb %}GB {{ product.size_gb }}
                {% else %}{{ product.display_size }}{% endif %}
                – {{ product.price }} RON
              </p>
            </div>

            <div class="tf-sticky-atc-btns">
              <button class="tf-btn btn-primary animate-btn btn-add-to-cart d-inline-flex justify-content-center"
                      type="submit"
                      {% if not product.is_active or product.is_archived %}disabled{% endif %}>
                Adaugă în coș
              </button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>
  <!-- /Sticky ATC -->

</section>
<!-- /Product Main -->

<!-- Product Description -->
<section class="flat-spacing pt-0">
  <div class="container">

    <!-- Descriptions -->
    <div class="widget-accordion wd-product-descriptions">
      <div class="accordion-title collapsed" data-bs-target="#description" data-bs-toggle="collapse"
           aria-expanded="true" aria-controls="description" role="button">
        <span>Descriere</span>
        <span class="icon icon-arrow-down"></span>
      </div>
      <div id="description" class="collapse">
        <div class="accordion-body widget-desc">

          {% if product.description %}
            <div class="item">
              <p class="mb-0">{{ product.description|linebreaksbr }}</p>
            </div>
          {% endif %}

          {% if product.material %}
            <div class="item">
              <p class="fw-medium title">Material</p>
              <ul><li>{{ product.material.name }}</li></ul>
            </div>
          {% endif %}

          {% if product.condition_notes %}
            <div class="item">
              <p class="fw-medium title">Observații</p>
              <p class="mb-0">{{ product.condition_notes }}</p>
            </div>
          {% endif %}

        </div>
      </div>
    </div>

    <!-- Additional Information -->
    <div class="widget-accordion wd-product-descriptions">
      <div class="accordion-title collapsed" data-bs-target="#addInformation" data-bs-toggle="collapse"
           aria-expanded="true" aria-controls="addInformation" role="button">
        <span>Informații suplimentare</span>
        <span class="icon icon-arrow-down"></span>
      </div>
      <div id="addInformation" class="collapse">
        <div class="accordion-body">
          <table class="tb-info-product text-md">
            <tbody>

              {# --- Material (single) --- #}
              {% if product.material %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Material</th>
                <td class="tb-attr-value"><p>{{ product.material.name }}</p></td>
              </tr>
              {% endif %}

              {# --- Color: real_color_name (nuanță) + base_color (culoare principală) --- #}
              {% if product.real_color_name or product.base_color %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Culoare</th>
                <td class="tb-attr-value">
                  <p>
                    {% if product.real_color_name %}
                      {{ product.real_color_name }}
                      {% if product.base_color and product.base_color.name and product.base_color.name != product.real_color_name %}
                        ({{ product.base_color.name }})
                      {% endif %}
                    {% else %}
                      {{ product.base_color.name }}
                    {% endif %}
                  </p>
                </td>
              </tr>
              {% endif %}

              {# --- Brand (brand sau brand_other) --- #}
              {% if product.display_brand %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Brand</th>
                <td class="tb-attr-value"><p>{{ product.display_brand }}</p></td>
              </tr>
              {% endif %}

              {# --- Category/Subcategory --- #}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Categorie</th>
                <td class="tb-attr-value"><p>{{ product.category.name }}</p></td>
              </tr>

              {% if product.subcategory %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Subcategorie</th>
                <td class="tb-attr-value"><p>{{ product.subcategory.get_breadcrumb }}</p></td>
              </tr>
              {% endif %}

              {# --- Size (prefer numeric fields if present) --- #}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Mărime</th>
                <td class="tb-attr-value">
                  <p>
                    {% if product.shoe_size_eu %}EU {{ product.shoe_size_eu }}
                    {% elif product.size_fr %}FR {{ product.size_fr }}
                    {% elif product.size_it %}IT {{ product.size_it }}
                    {% elif product.size_gb %}GB {{ product.size_gb }}
                    {% else %}{{ product.display_size }}{% endif %}
                  </p>
                </td>
              </tr>

              {% if product.fit %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Croi</th>
                <td class="tb-attr-value"><p>{{ product.get_fit_display }}</p></td>
              </tr>
              {% endif %}

              <tr class="tb-attr-item">
                <th class="tb-attr-label">Condiție</th>
                <td class="tb-attr-value"><p>{{ product.get_condition_display }}</p></td>
              </tr>

              {% if product.condition_notes %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Detalii condiție</th>
                <td class="tb-attr-value"><p>{{ product.condition_notes }}</p></td>
              </tr>
              {% endif %}

              <tr class="tb-attr-item">
                <th class="tb-attr-label">Gen</th>
                <td class="tb-attr-value"><p>{{ product.get_gender_display }}</p></td>
              </tr>

              {% if product.package_size %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Dimensiune colet</th>
                <td class="tb-attr-value"><p>{{ product.get_package_size_display }}</p></td>
              </tr>
              {% endif %}

              {% if product.weight_g %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Greutate</th>
                <td class="tb-attr-value"><p>{{ product.weight_g }} g</p></td>
              </tr>
              {% endif %}

              {% if product.pickup_location %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Locație ridicare</th>
                <td class="tb-attr-value">
                  <p>{% firstof product.pickup_location.label product.pickup_location.code "—" %}</p>
                </td>
              </tr>
              {% endif %}

              {# --- Sustainability --- #}
              {% if product.sustainability_none or product.sustainability_tags.all %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Sustenabilitate</th>
                <td class="tb-attr-value">
                  <p class="mb-0">
                    {% if product.sustainability_none %}
                      Nici una
                    {% else %}
                      {% for tag in product.sustainability_tags.all %}
                        {{ tag.name }}{% if not forloop.last %}, {% endif %}
                      {% endfor %}
                    {% endif %}
                  </p>
                </td>
              </tr>
              {% endif %}

              {# --- Return policy flag from subcategory --- #}
              {% if product.subcategory and product.subcategory.is_non_returnable %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Retur</th>
                <td class="tb-attr-value"><p>Nereturnabil (categorie specială)</p></td>
              </tr>
              {% endif %}

              {# --- Measurements: clothing fields --- #}
              {% with p=product %}
              {% if p.shoulders or p.bust or p.waist or p.hips or p.length or p.sleeve or p.inseam or p.outseam or p.shoulders_cm or p.bust_cm or p.waist_cm or p.hips_cm or p.length_cm or p.sleeve_cm or p.inseam_cm or p.outseam_cm %}
                <tr class="tb-attr-item">
                  <th class="tb-attr-label">Măsuri (haine)</th>
                  <td class="tb-attr-value">
                    <p class="mb-0">
                      {% if p.shoulders or p.shoulders_cm %}Umeri: {% firstof p.shoulders p.shoulders_cm %}{% if p.shoulders_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.bust or p.bust_cm %}Bust: {% firstof p.bust p.bust_cm %}{% if p.bust_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.waist or p.waist_cm %}Talie: {% firstof p.waist p.waist_cm %}{% if p.waist_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.hips or p.hips_cm %}Șold: {% firstof p.hips p.hips_cm %}{% if p.hips_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.length or p.length_cm %}Lungime: {% firstof p.length p.length_cm %}{% if p.length_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.sleeve or p.sleeve_cm %}Mâneca: {% firstof p.sleeve p.sleeve_cm %}{% if p.sleeve_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.inseam or p.inseam_cm %}Crac interior: {% firstof p.inseam p.inseam_cm %}{% if p.inseam_cm %} cm{% endif %}<br>{% endif %}
                      {% if p.outseam or p.outseam_cm %}Crac exterior: {% firstof p.outseam p.outseam_cm %}{% if p.outseam_cm %} cm{% endif %}{% endif %}
                    </p>
                  </td>
                </tr>
              {% endif %}
              {% endwith %}

              {# --- Measurements: shoes --- #}
              {% if product.shoe_insole_length_cm or product.shoe_width_cm or product.shoe_heel_height_cm or product.shoe_total_height_cm %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Măsuri (încălțăminte)</th>
                <td class="tb-attr-value">
                  <p class="mb-0">
                    {% if product.shoe_insole_length_cm %}Branț: {{ product.shoe_insole_length_cm }} cm<br>{% endif %}
                    {% if product.shoe_width_cm %}Lățime: {{ product.shoe_width_cm }} cm<br>{% endif %}
                    {% if product.shoe_heel_height_cm %}Toc: {{ product.shoe_heel_height_cm }} cm<br>{% endif %}
                    {% if product.shoe_total_height_cm %}Înălțime totală: {{ product.shoe_total_height_cm }} cm{% endif %}
                  </p>
                </td>
              </tr>
              {% endif %}

              {# --- Measurements: bags --- #}
              {% if product.bag_width_cm or product.bag_height_cm or product.bag_depth_cm or product.strap_length_cm %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Măsuri (geantă)</th>
                <td class="tb-attr-value">
                  <p class="mb-0">
                    {% if product.bag_width_cm %}Lățime: {{ product.bag_width_cm }} cm<br>{% endif %}
                    {% if product.bag_height_cm %}Înălțime: {{ product.bag_height_cm }} cm<br>{% endif %}
                    {% if product.bag_depth_cm %}Adâncime: {{ product.bag_depth_cm }} cm<br>{% endif %}
                    {% if product.strap_length_cm %}Baretă/șnur: {{ product.strap_length_cm }} cm{% endif %}
                  </p>
                </td>
              </tr>
              {% endif %}

              {# --- Measurements: belts --- #}
              {% if product.belt_length_total_cm or product.belt_length_usable_cm or product.belt_width_cm %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Măsuri (curea)</th>
                <td class="tb-attr-value">
                  <p class="mb-0">
                    {% if product.belt_length_total_cm %}Lungime totală: {{ product.belt_length_total_cm }} cm<br>{% endif %}
                    {% if product.belt_length_usable_cm %}Lungime utilă: {{ product.belt_length_usable_cm }} cm<br>{% endif %}
                    {% if product.belt_width_cm %}Lățime: {{ product.belt_width_cm }} cm{% endif %}
                  </p>
                </td>
              </tr>
              {% endif %}

              {# --- Measurements: jewelry --- #}
              {% if product.jewelry_chain_length_cm or product.jewelry_drop_length_cm or product.jewelry_pendant_size_cm %}
              <tr class="tb-attr-item">
                <th class="tb-attr-label">Măsuri (bijuterii)</th>
                <td class="tb-attr-value">
                  <p class="mb-0">
                    {% if product.jewelry_chain_length_cm %}Lanț/colier: {{ product.jewelry_chain_length_cm }} cm<br>{% endif %}
                    {% if product.jewelry_drop_length_cm %}Drop: {{ product.jewelry_drop_length_cm }} cm<br>{% endif %}
                    {% if product.jewelry_pendant_size_cm %}Pandantiv: {{ product.jewelry_pendant_size_cm }} cm{% endif %}
                  </p>
                </td>
              </tr>
              {% endif %}

            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Seller Info (în loc de Reviews) -->
    <div class="widget-accordion wd-product-descriptions">
      <div class="accordion-title collapsed" data-bs-target="#reviews" data-bs-toggle="collapse"
           aria-expanded="true" aria-controls="reviews" role="button">
        <span>Informații vânzător</span>
        <span class="icon icon-arrow-down"></span>
      </div>
      <div id="reviews" class="collapse">
        <div class="accordion-body wd-customer-review">
          <div class="review-heading">
            <h6 class="title">Despre vânzător</h6>
          </div>
          <div class="seller-info">
            <div class="d-flex align-items-center gap-3 mb-3">
              <div class="avatar-seller rounded-circle overflow-hidden">
                {% if product.owner.profile and product.owner.profile.avatar %}
                  <img src="{{ product.owner.profile.avatar.url }}"
                       alt="{{ product.owner.full_name }}"
                       width="60" height="60" class="img-fluid">
                {% else %}
                  <img src="{% static 'images/placeholders/avatar-default.png' %}"
                       alt="{{ product.owner.full_name|default:product.owner.email }}"
                       width="60" height="60" class="img-fluid">
                {% endif %}
              </div>
              <div>
                <div class="fw-medium text-md mb-1">
                  {{ product.owner.full_name|default:product.owner.email }}
                </div>
                {% with sp=product.owner.sellerprofile %}
                  {% if sp %}
                    <div class="text-sm text-main-4 mb-1">
                      {{ sp.get_seller_type_display }} · {{ sp.get_seller_level_display }}
                      {% if sp.has_kyc_badge %}
                        <span class="badge bg-success ms-1">KYC</span>
                      {% endif %}
                    </div>
                    <div class="text-sm text-main-4">
                      Trust score: {{ sp.seller_trust_score }}/100
                      <span class="hover-tooltip"
                            data-bs-toggle="tooltip"
                            title="A = foarte de încredere, D = risc ridicat.">
                        (Clasă {{ sp.seller_trust_class }})
                        <span class="tooltip">Scor calculat automat din istoricul de vânzări.</span>
                      </span>
                    </div>
                  {% endif %}
                {% endwith %}
              </div>
            </div>

            {% with sp=product.owner.sellerprofile %}
            <ul class="list-unstyled text-sm text-main-4 mb-0">
              <li>
                <strong>Membru din:</strong>
                {{ product.owner.date_joined|date:"d.m.Y" }}
              </li>
              {% if sp and sp.default_location %}
              <li>
                <strong>Locație principală:</strong>
                {{ sp.default_location.label|default:sp.default_location.code }}
              </li>
              {% endif %}
              <li>
                <strong>Anunțuri postate:</strong>
                {{ product.owner.products.all|length }}
              </li>
            </ul>
            {% endwith %}
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
<!-- /Product Description -->

<!-- People Also Bought -->
{% if related_products %}
<section>
  <div class="container">
    <div class="flat-title wow fadeInUp">
      <h4 class="title">Au cumpărat și</h4>
    </div>
    <div class="fl-control-sw2 wrap-pos-nav sw-over-product wow fadeInUp">
      <div dir="ltr" class="swiper tf-swiper wrap-sw-over" data-swiper='{
        "slidesPerView": 2,
        "spaceBetween": 12,
        "speed": 800,
        "observer": true,
        "observeParents": true,
        "slidesPerGroup": 2,
        "navigation": {
          "clickable": true,
          "nextEl": ".nav-next-bought",
          "prevEl": ".nav-prev-bought"
        },
        "pagination": { "el": ".sw-pagination-bought", "clickable": true },
        "breakpoints": {
          "768": { "slidesPerView": 3, "spaceBetween": 12, "slidesPerGroup": 3 },
          "1200": { "slidesPerView": 4, "spaceBetween": 24, "slidesPerGroup": 4}
        }
      }'>
        <div class="swiper-wrapper">
          {% for p in related_products %}
          <div class="swiper-slide">
            <div class="card-product style-2 card-product-size">
              <div class="card-product-wrapper">
                <a href="{{ p.get_absolute_url }}" class="product-img">
                  <img class="img-product lazyload" data-src="{{ p.main_image.url }}" src="{{ p.main_image.url }}" alt="{{ p.title }}">
                  <img class="img-hover lazyload" data-src="{{ p.main_image.url }}" src="{{ p.main_image.url }}" alt="{{ p.title }}">
                </a>
                <ul class="list-product-btn">
                  <li>
                    <form method="post" action="{% url 'cart:add' p.pk %}">{% csrf_token %}
                      <button class="box-icon hover-tooltip" type="submit">
                        <span class="icon icon-cart2"></span><span class="tooltip">Adaugă</span>
                      </button>
                    </form>
                  </li>
                  <li class="wishlist">
                    <form method="post"
                          action="{% url 'catalog:toggle_favorite' p.pk %}"
                          class="js-fav-form"
                          data-product-id="{{ p.pk }}">
                      {% csrf_token %}
                      <button type="submit" class="box-icon hover-tooltip {% if p.pk in favorite_ids %}active{% endif %}"
                              data-toggle-fav
                              aria-pressed="{% if p.pk in favorite_ids %}true{% else %}false{% endif %}">
                        <span class="icon icon-heart2"></span>
                        <span class="tooltip">Favorite</span>
                      </button>
                    </form>

                  </li>
                  <li>
                    <a href="{{ p.get_absolute_url }}" class="box-icon quickview hover-tooltip">
                      <span class="icon icon-view"></span><span class="tooltip">Detalii</span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="card-product-info">
                <a href="{{ p.get_absolute_url }}" class="name-product link fw-medium text-md">{{ p.title }}</a>
                <p class="price-wrap fw-medium">
                  <span class="price-new">{{ p.price }} RON</span>
                </p>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="d-flex d-xl-none sw-dot-default sw-pagination-bought justify-content-center"></div>
      </div>
      <div class="d-none d-xl-flex swiper-button-next nav-swiper nav-next-bought"></div>
      <div class="d-none d-xl-flex swiper-button-prev nav-swiper nav-prev-bought"></div>
    </div>
  </div>
</section>
{% endif %}
<!-- /People Also Bought -->

<!-- Recently Viewed -->
{% if recently_viewed %}
<section class="flat-spacing">
  <div class="container">
    <div class="flat-title wow fadeInUp">
      <h4 class="title">Văzute recent</h4>
    </div>
    <div class="fl-control-sw2 wrap-pos-nav sw-over-product wow fadeInUp">
      <div dir="ltr" class="swiper tf-swiper wrap-sw-over" data-swiper='{
        "slidesPerView": 2,
        "spaceBetween": 12,
        "speed": 800,
        "observer": true,
        "observeParents": true,
        "slidesPerGroup": 2,
        "navigation": {
          "clickable": true,
          "nextEl": ".nav-next-viewed",
          "prevEl": ".nav-prev-viewed"
        },
        "pagination": { "el": ".sw-pagination-viewed", "clickable": true },
        "breakpoints": {
          "768": { "slidesPerView": 3, "spaceBetween": 12, "slidesPerGroup": 3 },
          "1200": { "slidesPerView": 4, "spaceBetween": 24, "slidesPerGroup": 4}
        }
      }'>
        <div class="swiper-wrapper">
          {% for p in recently_viewed %}
          <div class="swiper-slide">
            <div class="card-product style-2 card-product-size">
              <div class="card-product-wrapper">
                <a href="{{ p.get_absolute_url }}" class="product-img">
                  <img class="img-product lazyload" data-src="{{ p.main_image.url }}" src="{{ p.main_image.url }}" alt="{{ p.title }}">
                  <img class="img-hover lazyload" data-src="{{ p.main_image.url }}" src="{{ p.main_image.url }}" alt="{{ p.title }}">
                </a>
                <ul class="list-product-btn">
                  <li>
                    <form method="post" action="{% url 'cart:add' p.pk %}">{% csrf_token %}
                      <button class="box-icon hover-tooltip" type="submit">
                        <span class="icon icon-cart2"></span><span class="tooltip">Adaugă</span>
                      </button>
                    </form>
                  </li>
                  <li class="wishlist">
                    <form method="post"
                          action="{% url 'catalog:toggle_favorite' p.pk %}"
                          class="js-fav-form"
                          data-product-id="{{ p.pk }}">
                      {% csrf_token %}
                      <button type="submit" class="box-icon hover-tooltip {% if p.pk in favorite_ids %}active{% endif %}"
                              data-toggle-fav
                              aria-pressed="{% if p.pk in favorite_ids %}true{% else %}false{% endif %}">
                        <span class="icon icon-heart2"></span>
                        <span class="tooltip">Favorite</span>
                      </button>
                    </form>
                  </li>
                  <li>
                    <a href="{{ p.get_absolute_url }}" class="box-icon quickview hover-tooltip">
                      <span class="icon icon-view"></span><span class="tooltip">Detalii</span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="card-product-info">
                <a href="{{ p.get_absolute_url }}" class="name-product link fw-medium text-md">{{ p.title }}</a>
                <p class="price-wrap fw-medium">
                  <span class="price-new">{{ p.price }} RON</span>
                </p>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        <div class="d-flex d-xl-none sw-dot-default sw-pagination-viewed justify-content-center"></div>
      </div>
      <div class="d-none d-xl-flex swiper-button-next nav-swiper nav-next-viewed"></div>
      <div class="d-none d-xl-flex swiper-button-prev nav-swiper nav-prev-viewed"></div>
    </div>
  </div>
</section>
{% endif %}
<!-- /Recently Viewed -->

<!-- === INIT SWIPER PENTRU GALLERY === -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof Swiper === 'undefined') {
      console.warn('Swiper JS nu este încărcat.');
      return;
    }

    // Thumbs
    var thumbsSwiper = new Swiper('.tf-product-media-thumbs', {
      spaceBetween: 8,
      slidesPerView: 4,
      direction: 'vertical',
      watchSlidesProgress: true,
      watchSlidesVisibility: true,
      freeMode: true,
      breakpoints: {
        0: { direction: 'horizontal' },
        768: { direction: 'vertical' }
      }
    });

    // Main gallery
    var mainSwiper = new Swiper('#gallery-swiper-started', {
      spaceBetween: 10,
      navigation: {
        nextEl: '.thumbs-next',
        prevEl: '.thumbs-prev',
      },
      thumbs: { swiper: thumbsSwiper }
    });
  });
</script>
<!-- /INIT SWIPER -->

{% endblock %}
