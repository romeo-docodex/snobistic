{% load static %}

<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="utf-8">
  <title>Factura {{ invoice.invoice_number }} – {{ platform_name }}</title>
  <style>
    @page { size: A4; margin: 20mm; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 12px; color: #111827; }
    h1, h2, h3, h4, h5 { margin: 0; padding: 0; }

    .invoice-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .brand-block { display: flex; align-items: center; gap: 10px; }
    .brand-logo { width: 40px; height: 40px; border-radius: 8px; background: #111827; color: #fff; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:16px; }

    .text-muted { color: #6b7280; }
    .small { font-size: 11px; }

    .section-title { font-size: 11px; text-transform: uppercase; letter-spacing: .08em; color: #6b7280; margin-bottom: 4px; }
    .parties { display: flex; gap: 20px; margin-bottom: 20px; }
    .party { flex: 1; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; }

    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { padding: 6px 8px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
    th { text-align: left; font-size: 11px; background: #f9fafb; }
    .text-right { text-align: right; }

    .totals-row { background: #f3f4f6; font-weight: 600; }
    .mt-16 { margin-top: 16px; }
  </style>
</head>
<body>

  <div class="invoice-header">
    <div class="brand-block">
      <div class="brand-logo">SN</div>
      <div>
        <div class="small text-muted">Factura</div>
        <h1 style="font-size: 18px; margin-top: 2px;">#{{ invoice.invoice_number }}</h1>
        <div class="small text-muted" style="margin-top: 8px;">
          Comanda #{{ order.id }} · {% if order.order_type == 'auction_win' %}Licitație{% else %}Magazin{% endif %} · {{ invoice.get_invoice_type_display }}
        </div>
      </div>
    </div>

    <div style="text-align: right;">
      <div class="small text-muted">Total</div>
      <div style="font-size: 18px; font-weight: 600;">{{ invoice.total_amount }} {{ invoice.currency }}</div>
      <div class="small text-muted" style="margin-top: 8px;">
        Emisă la {{ invoice.issued_at|date:"Y-m-d" }} {{ invoice.issued_at|date:"H:i" }}
      </div>
      <div class="small text-muted" style="margin-top: 8px;">
        Status: {{ invoice.get_status_display }}
      </div>
    </div>
  </div>

  <div class="small text-muted" style="margin-bottom: 16px;">
    {% if invoice.invoice_type == 'product' %}
      Factură pentru valoarea produselor din comanda #{{ order.id }}.
    {% elif invoice.invoice_type == 'shipping' %}
      Factură pentru costul de transport al comenzii #{{ order.id }}.
    {% elif invoice.invoice_type == 'commission' %}
      Factură de comision emisă de platforma {{ platform_name }} către vânzător.
    {% elif invoice.invoice_type == 'return' %}
      Factură aferentă unui retur (diferențe / regularizări) pentru comanda #{{ order.id }}.
    {% endif %}
  </div>

  <div class="parties">
    <div class="party">
      <div class="section-title">Beneficiar</div>
      <div style="font-weight: 600;">{{ invoice.bill_to_name|default:"—" }}</div>
      {% if invoice.bill_to_email %}<div class="small text-muted">{{ invoice.bill_to_email }}</div>{% endif %}
      {% if invoice.bill_to_vat %}<div class="small text-muted" style="margin-top: 8px;">CUI/VAT: {{ invoice.bill_to_vat }}</div>{% endif %}
    </div>

    <div class="party">
      <div class="section-title">Emitent</div>
      <div style="font-weight: 600;">{{ invoice.issuer_name|default:"—" }}</div>
      {% if invoice.issuer_vat %}<div class="small text-muted">CUI/VAT: {{ invoice.issuer_vat }}</div>{% endif %}
      {% if invoice.issuer_email %}<div class="small text-muted" style="margin-top: 8px;">{{ invoice.issuer_email }}</div>{% endif %}
    </div>
  </div>

  <div class="mt-16">
    <div class="section-title">Linii factură</div>
    <table>
      <thead>
        <tr>
          <th>Descriere</th>
          <th class="text-right" style="width: 80px;">Cant.</th>
          <th class="text-right" style="width: 140px;">Unit (net)</th>
          <th class="text-right" style="width: 90px;">TVA %</th>
          <th class="text-right" style="width: 150px;">Total</th>
        </tr>
      </thead>
      <tbody>
        {% for line in lines %}
          <tr>
            <td>
              <div style="font-weight: 600;">{{ line.description }}</div>
              <div class="small text-muted">
                {% if line.sku %}SKU: {{ line.sku }}{% endif %}
                {% if line.product_id %}{% if line.sku %} · {% endif %}Produs ID: {{ line.product_id }}{% endif %}
              </div>
            </td>
            <td class="text-right">{{ line.quantity }}</td>
            <td class="text-right">{{ line.unit_net_amount }} {{ line.currency }}</td>
            <td class="text-right">{{ line.vat_percent }}%</td>
            <td class="text-right">{{ line.total_amount }} {{ line.currency }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="text-muted">Nu există linii de factură.</td></tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="totals-row">
          <td colspan="4" class="text-right">Subtotal (net)</td>
          <td class="text-right">{{ invoice.net_amount }} {{ invoice.currency }}</td>
        </tr>
        <tr class="totals-row">
          <td colspan="4" class="text-right">TVA</td>
          <td class="text-right">{{ invoice.vat_amount }} {{ invoice.currency }}</td>
        </tr>
        <tr class="totals-row">
          <td colspan="4" class="text-right">Total de plată</td>
          <td class="text-right">{{ invoice.total_amount }} {{ invoice.currency }}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="small text-muted" style="margin-top: 16px;">
    Document generat automat din platforma {{ platform_name }}.
    Lipsa semnăturii și a ștampilei nu afectează valabilitatea facturii.
  </div>

</body>
</html>
