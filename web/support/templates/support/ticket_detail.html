{% extends "base.html" %}
{% block title %}Ticket #{{ ticket.id }}{% endblock %}
{% block content %}
<h1>#{{ ticket.id }} – {{ ticket.subject }}</h1>
<p>
  Status: <strong>{{ ticket.get_status_display }}</strong> |
  Prioritate: <strong>{{ ticket.get_priority_display }}</strong> |
  Categorie: <strong>{{ ticket.get_category_display }}</strong>
</p>

{% if ticket.order %}
  <div class="alert alert-light border mb-3">
    <p class="mb-1">
      <strong>Comandă legată:</strong>
      <a href="{% url 'orders:order_detail' ticket.order.id %}">
        #{{ ticket.order.id }}
      </a>
      – total {{ ticket.order.total }} RON
    </p>
    <p class="mb-0 text-muted">
      Status plată: {{ ticket.order.payment_status_label }} |
      Livrare: {{ ticket.order.get_shipping_status_display }} |
      Escrow: {{ ticket.order.escrow_status_label }}
    </p>
  </div>
{% endif %}

<hr>
<div class="mb-4">
  {% for msg in messages %}
    {% include "support/partials/message_bubble.html" with message=msg %}
  {% endfor %}
</div>

<h4>Răspunde:</h4>
<form method="post">
  {% csrf_token %}
  {% include "support/partials/form_errors.html" with form=msg_form %}
  {{ msg_form.as_p }}
  <button class="btn btn-success">Trimite</button>
</form>

{% if user.is_staff or user.has_perm "support.change_ticket" %}
  <hr>
  <a class="btn btn-warning" href="{% url 'support:ticket_update' ticket.id %}">
    Editează Ticket
  </a>
{% endif %}
<a class="btn btn-outline-secondary mt-3" href="{% url 'support:tickets_list' %}">
  Înapoi la solicitări
</a>
{% endblock %}
