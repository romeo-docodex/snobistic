{# dashboard/seller/wallet.html #}
{% extends "base.html" %}

{% block title %}Wallet vânzător – Snobistic{% endblock %}

{% block content %}

{# ==== Titlu pagină + breadcrumb ==== #}
<section class="tf-page-title">
  <div class="container">
    <div class="box-title text-center">
      <h4 class="title">Wallet Snobistic</h4>
      <div class="breadcrumb-list">
        <a class="breadcrumb-item" href="{% url 'core:home' %}">Acasă</a>
        <div class="breadcrumb-item dot"><span></span></div>
        <a class="breadcrumb-item" href="{% url 'dashboard:seller_dashboard' %}">
          Panou vânzător
        </a>
        <div class="breadcrumb-item dot"><span></span></div>
        <div class="breadcrumb-item current">Wallet</div>
      </div>
    </div>
  </div>
</section>

<div class="flat-spacing-13">
  <div class="container-7">

    {# Sidebar button (mobil) #}
    <div class="btn-sidebar-mb d-lg-none">
      <button data-bs-toggle="offcanvas" data-bs-target="#mbAccount">
        <i class="icon icon-sidebar"></i>
      </button>
    </div>

    <div class="main-content-account">
      {# ==== Sidebar desktop – meniu vânzător ==== #}
      <div class="sidebar-account-wrap sidebar-content-wrap sticky-top d-lg-block d-none">
        <ul class="my-account-nav">

          {# 1. Înapoi la dashboard utilizator #}
          <li>
            <a href="{% url 'accounts:profile' %}"
               class="text-sm link fw-medium my-account-nav-item">
              &larr; Înapoi la profil
            </a>
          </li>

          {# 2. Panou vânzător #}
          <li>
            <a href="{% url 'dashboard:seller_dashboard' %}"
               class="text-sm link fw-medium my-account-nav-item">
              Panou vânzător
            </a>
          </li>

          {# 3. Produsele mele #}
          <li>
            <a href="{% url 'dashboard:products_list' %}"
               class="text-sm link fw-medium my-account-nav-item">
              Produsele mele
            </a>
          </li>

          {# 4. Licitațiile mele #}
          <li>
            <a href="{% url 'dashboard:auctions_list' %}"
               class="text-sm link fw-medium my-account-nav-item">
              Licitațiile mele
            </a>
          </li>

          {# 5. Articole vândute #}
          <li>
            <a href="{% url 'dashboard:sold_list' %}"
               class="text-sm link fw-medium my-account-nav-item">
              Articole vândute
            </a>
          </li>

          {# 6. Wallet (pagina curentă) #}
          <li>
            <a href="{% url 'dashboard:wallet' %}"
               class="text-sm link fw-medium my-account-nav-item active">
              Wallet & încasări
            </a>
          </li>
        </ul>
      </div>

      {# ==== Conținut principal – Wallet ==== #}
      <div class="my-acount-content account-address">
        <h6 class="title-account mb-2">
          Wallet Snobistic
        </h6>
        <p class="text-sm text-grey mb-4">
          Aici vezi toate tranzacțiile tale interne (încasări, plăți comenzi, refund-uri)
          și soldul disponibil pentru retrageri sau cumpărături.
        </p>

        <div class="widget-inner-address">
          <div class="account-address-item">

            {# Header: sold + acțiuni #}
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
              <div>
                <p class="text-sm mb-1 text-grey">
                  Sold disponibil în Wallet
                </p>
                <div class="fs-4 fw-semibold">
                  {{ balance }} RON
                </div>
              </div>
              <div class="text-md-end">
                <div class="mb-2">
                  <a href="{% url 'payments:wallet_topup' %}"
                     class="tf-btn btn-out-line-dark me-1 mb-1">
                    Încărcare
                  </a>
                  <a href="{% url 'payments:wallet_withdraw' %}"
                     class="tf-btn btn-dark mb-1">
                    Retragere
                  </a>
                </div>
                <p class="text-xxs text-grey mb-0">
                  Retragerile pot necesita verificări suplimentare de securitate.
                </p>
              </div>
            </div>

            {# Filtre perioadă + export CSV #}
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 gap-2">
              <div class="btn-group btn-group-sm" role="group">
                <a href="?period=all"
                   class="btn btn-outline-secondary {% if period == 'all' %}active{% endif %}">
                  Toate
                </a>
                <a href="?period=daily"
                   class="btn btn-outline-secondary {% if period == 'daily' %}active{% endif %}">
                  Azi
                </a>
                <a href="?period=monthly"
                   class="btn btn-outline-secondary {% if period == 'monthly' %}active{% endif %}">
                  Luna curentă
                </a>
                <a href="?period=yearly"
                   class="btn btn-outline-secondary {% if period == 'yearly' %}active{% endif %}">
                  An curent
                </a>
              </div>

              <a href="?period={{ period }}&export=csv"
                 class="btn btn-sm btn-outline-secondary">
                Export CSV
              </a>
            </div>

            {# Tabel tranzacții #}
            <div class="table-responsive">
              <table class="table mb-0 align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Dată</th>
                    <th>Tip</th>
                    <th>Metodă</th>
                    <th class="text-end">Sumă (RON)</th>
                    <th class="text-end">Sold după</th>
                  </tr>
                </thead>
                <tbody>
                {% if transactions %}
                  {% for tx in transactions %}
                    <tr>
                      <td class="small">
                        {{ tx.date|date:"Y-m-d H:i" }}
                      </td>
                      <td class="small">
                        {{ tx.get_transaction_type_display }}
                      </td>
                      <td class="small">
                        {{ tx.method }}
                      </td>
                      <td class="text-end">
                        {% if tx.transaction_type == 'withdraw' %}
                          <span class="text-danger">-{{ tx.amount }}</span>
                        {% else %}
                          <span class="text-success">+{{ tx.amount }}</span>
                        {% endif %}
                      </td>
                      <td class="text-end small">
                        {{ tx.balance_after }}
                      </td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="5" class="text-center py-4 text-muted">
                      Nu există tranzacții pentru perioada selectată.
                    </td>
                  </tr>
                {% endif %}
                </tbody>
              </table>
            </div>

          </div> {# /account-address-item #}
        </div> {# /widget-inner-address #}
      </div> {# /my-acount-content #}
    </div> {# /main-content-account #}

  </div>
</div>

{% endblock %}
